{% extends "books/yourlibrary.html" %}

{% block content %}
<h1>Library Home!</h1>

<!-- Top Bar: Add Book (left) + View History (right) -->
<div class="d-flex justify-content-between mb-3">
    <a href="{% url 'book-create' %}" class="btn btn-success">
        + Add New Book
    </a>
    <a href="{% url 'borrow-history' %}" class="btn btn-secondary">
        ðŸ“œ View Book History
    </a>
</div>

<!-- WISHLIST Section -->
<h3>Wishlist</h3>
{% with has_books=False %}
{% for book in books %}
    {% if book.status == "wishlist" %}
        {% with has_books=True %}
        {% endwith %}
        <article class="media content-section">
            <div class="media-body">
                <div class="article-metadata d-flex justify-content-between align-items-center">
                    <div>
                        <a class="mr-2" href="{% url 'book-detail' book.id %}">{{ book.title }}</a>
                        <small class="text-muted">{{ book.author }}</small>
                    </div>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'book-detail' book.id %}" class="btn btn-outline-info">Read</a>
                        <a href="{% url 'book-update' book.id %}" class="btn btn-outline-warning">Update</a>
                        <a href="{% url 'book-delete' book.id %}" class="btn btn-outline-danger">Delete</a>
                        <form action="{% url 'book-borrow' book.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-success btn-sm">Borrow</button>
                        </form>
                    </div>
                </div>
                <p class="article-content">{{ book.genre }}</p>
            </div>
        </article>
    {% endif %}
{% endfor %}
{% if not has_books %}
    <p class="text-muted">No books in this section.</p>
{% endif %}
{% endwith %}

<!-- READING Section -->
<h3>Currently Reading</h3>
{% with has_books=False %}
{% for book in books %}
    {% if book.status == "reading" %}
        {% with has_books=True %}
        {% endwith %}
        <article class="media content-section">
            <div class="media-body">
                <div class="article-metadata d-flex justify-content-between align-items-center">
                    <div>
                        <a class="mr-2" href="{% url 'book-detail' book.id %}">{{ book.title }}</a>
                        <small class="text-muted">{{ book.author }}</small>
                    </div>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'book-detail' book.id %}" class="btn btn-outline-info">Read</a>
                        <a href="{% url 'book-update' book.id %}" class="btn btn-outline-warning">Update</a>
                        <a href="{% url 'book-delete' book.id %}" class="btn btn-outline-danger">Delete</a>
                        <form action="{% url 'book-return' book.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-primary btn-sm">Return</button>
                        </form>
                    </div>
                </div>
                <p class="article-content">{{ book.genre }}</p>
            </div>
        </article>
    {% endif %}
{% endfor %}
{% if not has_books %}
    <p class="text-muted">No books in this section.</p>
{% endif %}
{% endwith %}

<!-- COMPLETED Section -->
<h3>Completed Books</h3>
{% with has_books=False %}
{% for book in books %}
    {% if book.status == "completed" %}
        {% with has_books=True %}
        {% endwith %}
        <article class="media content-section">
            <div class="media-body">
                <div class="article-metadata d-flex justify-content-between align-items-center">
                    <div>
                        <a class="mr-2" href="{% url 'book-detail' book.id %}">{{ book.title }}</a>
                        <small class="text-muted">{{ book.author }}</small>
                    </div>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'book-detail' book.id %}" class="btn btn-outline-info">Read</a>
                        <a href="{% url 'book-update' book.id %}" class="btn btn-outline-warning">Update</a>
                        <a href="{% url 'book-delete' book.id %}" class="btn btn-outline-danger">Delete</a>
                        <!-- âœ… No Return button here -->
                    </div>
                </div>
                <p class="article-content">{{ book.genre }}</p>
            </div>
        </article>
    {% endif %}
{% endfor %}
{% if not has_books %}
    <p class="text-muted">No books in this section.</p>
{% endif %}
{% endwith %}


{% endblock %}
